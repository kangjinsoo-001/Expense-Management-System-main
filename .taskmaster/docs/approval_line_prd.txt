# 경비 시스템 결재선 기능 PRD

## 개요
경비 청구 시 순차적인 승인 프로세스를 관리하는 결재선 기능을 구현합니다. 사용자가 미리 정의한 결재선을 통해 경비 항목이 단계별로 승인되는 시스템입니다.

## 핵심 기능

### 1. 결재선 관리
- 각 사용자가 자신만의 결재선을 여러 개 생성 및 관리
- 결재선 구성 요소:
  - 결재선 이름 (예: "야근용", "일반 경비용")
  - 결재선 소유자 (생성한 사용자)
  - 단계별 승인자 목록 (1차, 2차, 3차...)
- 결재선 CRUD 기능
  - 생성: 이름 입력 후 단계별로 승인자 추가
  - 수정: 승인자 변경, 단계 추가/삭제
  - 삭제: 사용 중이 아닌 결재선 삭제
  - 목록 조회: 본인이 생성한 결재선 목록

### 2. 경비 항목에 결재선 적용
- 경비 항목 추가/수정 시 결재선 선택 옵션
- 결재가 필요한 항목에만 선택적으로 적용
- 선택된 결재선의 승인자 정보 미리보기

### 3. 승인자 대시보드
- 승인 대기 중인 항목 목록
  - 내 차례가 된 항목만 표시 (이전 단계 모두 승인 완료된 건)
  - 신청자, 경비 코드, 금액, 신청일 등 핵심 정보 표시
- 승인 항목 상세 화면
  - 경비 항목 전체 정보
  - 결재 진행 상황
    - 각 단계별 승인자와 상태 (완료/대기중/반려)
    - 승인/반려 일시
    - 코멘트 (있는 경우)
  - 승인/반려 버튼
    - 승인 시: 선택적 코멘트 입력
    - 반려 시: 필수 반려 사유 입력

### 4. 신청자 결재 상태 확인
- 경비 시트 목록에서 결재 상태 표시
  - "결재 진행중 - [현재 승인자명]"
  - "결재 완료"
  - "반려됨 - [반려자명]"
- 경비 항목 상세 화면에서 결재 진행 상황 확인
  - 전체 결재선과 각 단계별 상태
  - 반려된 경우 반려 사유 확인

## 데이터 모델

### ApprovalLine (결재선)
- id
- user_id (소유자)
- name (결재선 이름)
- created_at
- updated_at

### ApprovalLineStep (결재선 단계)
- id
- approval_line_id
- approver_id (승인자 user_id)
- step_order (순서: 1, 2, 3...)
- created_at
- updated_at

### ExpenseApproval (경비 승인 요청)
- id
- expense_sheet_item_id
- approval_line_id
- current_step (현재 승인 단계)
- status (진행중/완료/반려)
- created_at
- updated_at

### ApprovalHistory (승인 이력)
- id
- expense_approval_id
- approver_id
- step_order
- action (승인/반려)
- comment (코멘트)
- created_at

## UI/UX 요구사항

### 결재선 관리 화면
- 결재선 목록 테이블
- 새 결재선 생성 버튼
- 단계별 승인자 추가/삭제 인터페이스
- 사용자 검색 및 선택 기능

### 승인자 대시보드
- 승인 대기 항목 필터링 및 정렬
- 일괄 승인 기능 (선택사항)
- 승인/반려 시 모달 팝업으로 코멘트 입력

### 경비 시트 통합
- 결재선 선택 드롭다운
- 결재 상태 뱃지/태그
- 결재 진행 상황 타임라인 UI

## 기술 고려사항
- Turbo Streams를 활용한 실시간 상태 업데이트
- 승인 권한 검증 로직
- 결재선 변경 시 진행 중인 승인 건 처리 정책
- 대량 승인 요청 시 성능 최적화

## 구현 우선순위
1. 결재선 모델 및 기본 CRUD
2. 경비 항목과 결재선 연동
3. 승인 프로세스 핵심 로직
4. 승인자 대시보드
5. 신청자 결재 상태 표시