# 경비 항목 예산 입력 기능 PRD

## 개요
경비 항목에 사전 예산 승인 기능을 추가하여, 실제 지출 전에 예산을 승인받고 나중에 실제 집행 금액을 입력할 수 있도록 한다.

## 비즈니스 요구사항

### 1. 예산 입력 모드
- 경비 항목 생성/수정 시 "예산 사전 입력" 체크박스 제공
- 체크 시 금액 필드가 "예산 금액"으로 변경
- 예산 모드에서는 실제 지출 금액 대신 예상 예산 입력

### 2. 예산 승인 프로세스
- 예산도 기존 비용 금액과 동일한 승인 규칙 적용
- 경비 코드별 승인 규칙에 따라 승인자 결정
- 예산 금액 기준으로 승인 단계 결정

### 3. 실제 집행 금액 입력
- 예산 승인 완료 후 실제 집행 금액 입력 가능
- 예산 범위 내: 추가 승인 없이 금액 확정
- 예산 초과: 재승인 프로세스 필요
- 집행 금액 입력 시 예산 대비 실집행 비율 표시

### 4. 예산 초과 처리
- 예산 초과 시 경고 메시지 표시
- 초과 사유 입력 필수
- 초과 금액에 대한 재승인 요청 자동 생성
- 기존 승인 이력 유지하면서 추가 승인 진행

## 기술 요구사항

### 1. 데이터베이스 변경
- expense_items 테이블에 필드 추가:
  - is_budget (boolean): 예산 모드 여부
  - budget_amount (decimal): 승인된 예산 금액
  - actual_amount (decimal): 실제 집행 금액
  - budget_exceeded (boolean): 예산 초과 여부
  - excess_reason (text): 초과 사유
  - budget_approved_at (datetime): 예산 승인 일시
  - actual_approved_at (datetime): 실집행 승인 일시

### 2. UI/UX 변경
- 경비 항목 폼:
  - "예산 사전 입력" 체크박스 추가
  - 체크 시 금액 라벨 동적 변경 (금액 → 예산)
  - 예산 승인 완료 항목에 "집행 금액 입력" 버튼 추가
  
- 경비 항목 목록:
  - 예산/실집행 구분 표시 (뱃지 또는 아이콘)
  - 예산 대비 집행률 표시 (진행바)
  - 예산 초과 항목 하이라이트

- 집행 금액 입력 모달:
  - 승인된 예산 금액 표시
  - 실제 집행 금액 입력 필드
  - 예산 대비 차액 실시간 계산
  - 초과 시 사유 입력 필드 자동 표시

### 3. 승인 프로세스 변경
- 예산 승인과 실집행 승인 구분
- 승인 요청 시 예산/실집행 구분 표시
- 예산 초과 재승인 시 이전 승인 이력 참조 가능

### 4. 검증 로직
- 예산 모드에서는 영수증 첨부 선택적
- 실집행 입력 시 영수증 첨부 필수
- 예산 초과 시 초과 사유 필수 입력
- 실집행 금액은 0보다 커야 함

### 5. 알림 및 리포팅
- 예산 승인 완료 시 신청자에게 알림
- 예산 초과 재승인 요청 시 승인자에게 알림
- 예산 대비 집행 현황 리포트 제공

## 구현 우선순위
1. 데이터베이스 마이그레이션 및 모델 수정
2. 예산 입력 UI 구현
3. 예산 승인 프로세스 구현
4. 실집행 금액 입력 기능 구현
5. 예산 초과 재승인 프로세스 구현
6. 리포팅 및 대시보드 개선

## 예상 작업량
- 총 예상 작업 시간: 40-48시간
- 백엔드 개발: 20시간
- 프론트엔드 개발: 16시간
- 테스트 및 검증: 8시간

## 성공 지표
- 예산 입력 및 승인 프로세스 정상 작동
- 예산 초과 시 재승인 프로세스 자동 실행
- 사용자가 예산과 실집행을 명확히 구분 가능
- 예산 대비 집행 현황을 한눈에 파악 가능