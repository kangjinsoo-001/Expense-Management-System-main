<% content_for :title, "경비 코드 수정" %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-semibold text-gray-900">경비 코드 수정</h1>
        <p class="mt-1 text-sm text-gray-500"><%= @expense_code.name %> 코드를 수정합니다</p>
      </div>
      <%= link_to admin_expense_codes_path, 
                  class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
        <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        목록으로
      <% end %>
    </div>
  </div>

  <div id="expense_code_form_wrapper">
    <%= render 'form', expense_code: @expense_code %>
  </div>
  
  <!-- 승인 규칙 관리 섹션 (메인 폼과 분리) -->
  <div class="mt-8">
    <%= render 'approval_rules_edit', expense_code: @expense_code, approval_rules: @approval_rules, available_groups: @available_groups %>
  </div>
  
  <!-- 버튼 영역 (수정 페이지용) -->
  <div class="mt-8 flex justify-end gap-3">
    <%= link_to "취소", admin_expense_codes_path, 
        class: "inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
    <button type="button" 
            id="submit_expense_code_form"
            class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
      수정
    </button>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const submitButton = document.getElementById('submit_expense_code_form');
      if (submitButton) {
        submitButton.addEventListener('click', function() {
          const form = document.querySelector('#expense_code_form_wrapper form[data-controller="expense-code-form"]');
          if (form) {
            form.submit();
          }
        });
      }
    });
  </script>
</div>
