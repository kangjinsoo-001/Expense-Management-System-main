<tr id="<%= dom_id(approval_line) %>" data-approval-line-id="<%= approval_line.id %>" class="sortable-item">
  <td class="text-center drag-handle" style="cursor: move; user-select: none; -webkit-user-select: none;">
    <svg class="h-5 w-5 text-gray-400 inline-block pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </td>
  <td class="font-medium">
    <%= approval_line.name %>
  </td>
  <td>
    <div class="space-y-1">
      <% grouped_steps = approval_line.approval_line_steps.ordered.group_by(&:step_order) %>
      <% grouped_steps.each do |step_order, steps| %>
        <div class="text-sm flex items-center">
          <span class="font-medium text-gray-700 mr-2"><%= step_order %>.</span>
          <% approvers = steps.select(&:role_approve?) %>
          <% if approvers.length >= 2 %>
            <span class="mr-3 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= approvers.first.approval_type == 'all_required' ? 'bg-purple-100 text-purple-800' : 'bg-green-100 text-green-800' %>">
              <%= approval_type_icon_svg(approvers.first.approval_type, size: 'w-3 h-3', css_class: 'mr-1') %>
              <%= approval_type_text(approvers.first.approval_type) %>
            </span>
          <% end %>
          <% steps.each_with_index do |step, index| %>
            <% if index > 0 %>
              <span class="mx-1 text-gray-300">|</span>
            <% end %>
            <div class="inline-flex items-center">
              <%= approval_role_icon_svg(step.role, size: 'w-4 h-4', css_class: 'mr-1') %>
              <span class="text-gray-900">
                <%= step.approver.name %>
                <% if step.approver.approver_groups.any? %>
                  <% highest_group = step.approver.approver_groups.max_by(&:priority) %>
                  <span class="text-gray-500 text-xs">(<%= highest_group.name %>)</span>
                <% end %>
              </span>
              <span class="ml-1 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium <%= step.role == 'approve' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-600' %>">
                <%= step.role == 'approve' ? '승인' : '참조' %>
              </span>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </td>
  <td>
    <span class="<%= approval_line.is_active ? 'tremor-badge-success' : 'tremor-badge-error' %> tremor-badge">
      <%= approval_line.is_active ? '활성' : '비활성' %>
    </span>
  </td>
  <td class="text-center">
    <div class="flex items-center justify-center gap-1">
      <%= link_to approval_line_path(approval_line), 
          class: "p-1.5 rounded hover:bg-gray-100 transition-colors group",
          title: "보기" do %>
        <svg class="h-4 w-4 text-gray-500 group-hover:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
      <% end %>
      <%= link_to edit_approval_line_path(approval_line), 
          class: "p-1.5 rounded hover:bg-gray-100 transition-colors group",
          title: "편집" do %>
        <svg class="h-4 w-4 text-gray-500 group-hover:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
      <% end %>
      <%= button_to toggle_active_approval_line_path(approval_line),
          method: :patch,
          class: "p-1.5 rounded hover:bg-gray-100 transition-colors group",
          title: approval_line.is_active ? "비활성화" : "활성화" do %>
        <% if approval_line.is_active %>
          <svg class="h-4 w-4 text-gray-500 group-hover:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
          </svg>
        <% else %>
          <svg class="h-4 w-4 text-gray-500 group-hover:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        <% end %>
      <% end %>
      <%= button_to approval_line_path(approval_line), 
          method: :delete,
          data: { 
            turbo_confirm: "정말 삭제하시겠습니까?\n\n이 결재선을 사용한 승인 요청이 있더라도 해당 승인 요청은 영향받지 않습니다."
          },
          class: "p-1.5 rounded hover:bg-red-50 transition-colors group",
          title: "삭제" do %>
        <svg class="h-4 w-4 text-gray-500 group-hover:text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      <% end %>
    </div>
  </td>
</tr>